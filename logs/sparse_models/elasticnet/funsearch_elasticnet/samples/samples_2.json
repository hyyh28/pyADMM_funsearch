{
  "sample_order": 2,
  "function": "def elasticnet(A, B, lambd, opts):\n    tol = opts.get('tol', 1e-8)\n    max_iter = opts.get('max_iter', 500)\n    rho = opts.get('rho', 1.1)\n    mu = opts.get('mu', 1e-4)\n    max_mu = opts.get('max_mu', 1e10)\n    DEBUG = opts.get('DEBUG', 0)\n    \n    d, na = A.shape\n    _, nb = B.shape\n\n    X = np.zeros((na, nb))\n    Z = np.zeros_like(X)\n    Y1 = np.zeros((d, nb))\n    Y2 = np.zeros_like(X)\n\n    AtB = A.T @ B\n    I = np.eye(na)\n    invAtAI = np.linalg.inv(A.T @ A + I) @ I\n\n    def update_rho(rho, dY1, dY2):\n        rho_incr = 2.0\n        rho_decr = 2.0\n        norm_dY1 = np.linalg.norm(dY1, 'fro')\n        norm_dY2 = np.linalg.norm(dY2, 'fro')\n        if norm_dY1 > 10 * norm_dY2:\n            rho *= rho_incr\n        elif norm_dY2 > 10 * norm_dY1:\n            rho /= rho_decr\n        return rho\n\n    for iter in range(1, max_iter + 1):\n        Xk = X.copy()\n        Zk = Z.copy()\n        # update X\n        X = prox_elasticnet(Z - Y2 / mu, 1 / mu, lambd / mu)\n        # update Z\n        Z = invAtAI @ (-(A.T @ Y1 - Y2) / mu + AtB + X)\n        dY1 = A @ Z - B\n        dY2 = X - Z\n        chgX = np.max(np.abs(Xk - X))\n        chgZ = np.max(np.abs(Zk - Z))\n        chg = max([chgX, chgZ, np.max(np.abs(dY1)), np.max(np.abs(dY2))])\n        \n        if DEBUG and (iter == 1 or iter % 10 == 0):\n            obj = np.linalg.norm(X.ravel(), 1) + lambd * np.linalg.norm(X, 'fro')**2\n            err = np.sqrt(np.linalg.norm(dY1, 'fro')**2 + np.linalg.norm(dY2, 'fro')**2)\n            print(f'iter {iter}, mu={mu}, rho={rho}, obj={obj}, err={err}')\n        \n        if chg < tol:\n            break\n        \n        Y1 = Y1 + mu * dY1\n        Y2 = Y2 + mu * dY2\n        mu = min(rho * mu, max_mu)\n        rho = update_rho(rho, dY1, dY2)\n    \n    obj = np.linalg.norm(X.ravel(), 1) + lambd * np.linalg.norm(X, 'fro')**2\n    err = np.sqrt(np.linalg.norm(dY1, 'fro')**2 + np.linalg.norm(dY2, 'fro')**2)\n    \n    return X, obj, err, iter\n\n",
  "score": null
}
